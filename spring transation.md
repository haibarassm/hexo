# spring事务

## 4种事务特性

	原子性 （atomicity）:强调事务的不可分割.  

	一致性 （consistency）:事务的执行的前后数据的完整性保持一致.   

	隔离性 （isolation）:一个事务执行的过程中,不应该受到其他事务的干扰   

	持久性（durability） :事务一旦结束,数据就持久到数据库  

## 5种隔离级别

### 如果不考虑隔离性引发安全性问题 
类型 | 解释 | 
--- | ---|  
 脏读 |指当一个事务正在访问数据，并且对数据进行了修改，而这种修改还没有提交到数据库中，这时，另外一个事务也访问这个数据，然后使用了这个数据。因为这个数据是还没有提交的数据，那么另外一个事务读到的这个数据是脏数据，依据脏数据所做的操作可能是不正确的。|
 不可重复读 |指在一个事务内，多次读同一数据。在这个事务还没有结束时，另外一个事务也访问该同一数据.那么，在第一个事务中的两次读数据之间，由于第二个事务的修改，那么第一个事务两次读到的数据可能是不一样的。这样就发生了在一个事务内两次读到的数据是不一样的，因此称为是不可重复读。|
  幻觉读 | 指当事务不是独立执行时发生的一种现象，例如第一个事务对一个表中的数据进行了修改，这种修改涉及到表中的全部数据行。同时，第二个事务也修改这个表中的数据，这种修改是向表中插入一行新数据。那么，以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好象发生了幻觉一样。|
	
### 事务隔离级别	
名称|隔离级别|
---|-------|
  ISOLATION_DEFAULT|这是一个PlatfromTransactionManager默认的隔离级别，使用数据库默认的事务隔离级别.|
  ISOLATION_READ_UNCOMMITTED|这是事务最低的隔离级别，它允许另外一个事务可以看到这个事务未提交的数据。这种隔离级别会产生脏读，不可重复读和幻像读。|
  ISOLATION_READ_COMMITTED|保证一个事务修改的数据提交后才能被另外一个事务读取。另外一个事务不能读取该事务未提交的数据|
   ISOLATION_REPEATABLE_READ| 这种事务隔离级别可以防止脏读，不可重复读。但是可能出现幻像读。|
  ISOLATION_SERIALIZABLE|这是花费最高代价但是最可靠的事务隔离级别。事务被处理为顺序执行。除了防止脏读，不可重复读外，还避免了幻像读。| 
	
Mysql 默认:可重复读  
Sql Server 默认:已提交读  
Oracle 默认:已提交读

## 7种传播行为
### 保证同一个事务中 

PROPAGATION_REQUIRED 支持当前事务，如果不存在 就新建一个(默认)  

PROPAGATION_SUPPORTS 支持当前事务，如果不存在，就不使用事务  

PROPAGATION_MANDATORY 支持当前事务，如果不存在，抛出异常  

### 保证没有在同一个事务中 

PROPAGATION_REQUIRES_NEW 如果有事务存在，挂起当前事务，创建一个新的事务  

PROPAGATION_NOT_SUPPORTED 以非事务方式运行，如果有事务存在，挂起当前事务  

PROPAGATION_NEVER 以非事务方式运行，如果有事务存在，抛出异常  

PROPAGATION_NESTED 如果当前事务存在，则嵌套事务执行  
